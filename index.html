<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unutmam Ben!</title>
    <!-- Font Awesome ve Tailwind CSS kütüphanelerini yüklüyoruz -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Google Fonts - Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Açık mod arka plan rengi */
            color: #1a202c; /* Açık mod yazı rengi */
            transition: background-color 0.3s, color 0.3s;
        }
        /* Karanlık mod stilleri */
        .dark-mode body {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .card {
            background-color: #ffffff;
            transition: background-color 0.3s;
        }
        .dark-mode .card {
            background-color: #2d3748;
        }
        .btn-primary {
            background-color: #4a5568;
            color: #ffffff;
            transition: background-color 0.3s;
        }
        .dark-mode .btn-primary {
            background-color: #a0aec0;
            color: #1a202c;
        }
        .btn-primary:hover {
            background-color: #2d3748;
        }
        .dark-mode .btn-primary:hover {
            background-color: #c0c6d4;
        }
        /* Karanlık mod için anahtar düğme stilleri */
        .toggle-switch {
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4a5568;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        /* Sesli not oynatıcı stilleri */
        .voice-note-player {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #edf2f7;
            padding: 8px 12px;
            border-radius: 8px;
        }
        .dark-mode .voice-note-player {
            background-color: #4a5568;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Üst Menü Çubuğu (Navbar) -->
    <header class="bg-gray-800 text-white p-4 shadow-md flex justify-between items-center fixed top-0 left-0 w-full z-10">
        <h1 class="text-2xl font-bold">Unutmam Ben!</h1>
        <div class="flex items-center gap-4">
            <!-- Karanlık/Aydınlık Mod Butonu -->
            <button id="toggle-theme" class="text-white p-2 rounded-full hover:bg-gray-700 transition">
                <i class="fas fa-moon text-lg" id="theme-icon"></i>
            </button>
            <!-- Ayarlar Sayfası Butonu -->
            <button id="open-settings" class="text-white p-2 rounded-full hover:bg-gray-700 transition">
                <i class="fas fa-cog text-lg"></i>
            </button>
        </div>
    </header>

    <!-- Ana İçerik Alanı -->
    <main class="flex-grow p-4 mt-16 pb-20">
        <div id="main-view" class="container mx-auto max-w-xl">
            
            <!-- Ana Sayfa - Hatırlatıcı Listesi -->
            <div id="home-view" class="space-y-4">
                <div id="reminder-list">
                    <!-- Hatırlatıcılar buraya dinamik olarak eklenecek -->
                </div>
            </div>

            <!-- Yeni Hatırlatıcı Ekleme Formu -->
            <div id="add-reminder-view" class="hidden">
                <div class="card p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-4">Yeni Hatırlatıcı Ekle</h2>
                    <input id="reminder-text" type="text" placeholder="Hatırlatmak istediğin şeyi yaz..." class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 mb-4">

                    <div class="flex items-center space-x-4 mb-4">
                        <input id="reminder-datetime" type="datetime-local" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                    </div>

                    <!-- Emoji Seçme Butonu ve Konteyneri -->
                    <div class="relative mb-4">
                        <button id="toggle-emoji-picker" class="w-full p-3 rounded-lg bg-gray-200 hover:bg-gray-300 transition text-gray-700">
                            <i class="far fa-smile mr-2"></i>Emoji Ekle
                        </button>
                        <div id="emoji-picker-container" class="absolute hidden z-20 top-full mt-2 w-full">
                            <!-- TODO: Buraya emoji klavyesi eklenecek -->
                        </div>
                    </div>

                    <!-- Sesli Not Kaydetme Butonu -->
                    <button id="record-voice" class="w-full p-3 rounded-lg bg-red-500 hover:bg-red-600 transition text-white font-bold mb-4">
                        <i class="fas fa-microphone mr-2"></i>Sesli Not Kaydet
                    </button>
                    <div id="voice-note-preview" class="hidden flex items-center justify-between p-3 rounded-lg bg-gray-200 dark:bg-gray-700 mb-4">
                        <audio id="voice-note-audio" controls class="w-full"></audio>
                        <button id="clear-voice-note" class="ml-2 text-red-500 hover:text-red-700">
                            <i class="fas fa-times-circle text-xl"></i>
                        </button>
                    </div>

                    <button id="save-reminder" class="btn-primary w-full p-4 rounded-xl shadow-lg text-lg font-bold">Kaydet</button>
                </div>
            </div>

            <!-- Ayarlar Sayfası -->
            <div id="settings-view" class="hidden">
                <div class="card p-6 rounded-xl shadow-lg space-y-4">
                    <h2 class="text-xl font-bold">Ayarlar</h2>
                    <div class="flex justify-between items-center">
                        <span>Karanlık Mod</span>
                        <label class="toggle-switch relative inline-block">
                            <input type="checkbox" id="dark-mode-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Yeni Hatırlatıcı Ekleme Butonu (FAB) -->
    <button id="fab-add" class="fixed bottom-4 right-4 bg-gray-800 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-3xl hover:bg-gray-700 transition">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- Toast Mesajları için Konteyner -->
    <div id="toast-container" class="fixed bottom-16 left-1/2 -translate-x-1/2 flex flex-col items-center z-50"></div>
    
    <script>
        // DOM elementlerini seçiyoruz
        const body = document.body;
        const toggleThemeButton = document.getElementById('toggle-theme');
        const themeIcon = document.getElementById('theme-icon');
        const openSettingsButton = document.getElementById('open-settings');
        const homeView = document.getElementById('home-view');
        const addReminderView = document.getElementById('add-reminder-view');
        const settingsView = document.getElementById('settings-view');
        const fabAdd = document.getElementById('fab-add');
        const reminderList = document.getElementById('reminder-list');
        const reminderText = document.getElementById('reminder-text');
        const reminderDateTime = document.getElementById('reminder-datetime');
        const saveReminderButton = document.getElementById('save-reminder');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const toastContainer = document.getElementById('toast-container');
        
        // Sesli not kayıt ve oynatma elementleri
        const recordVoiceButton = document.getElementById('record-voice');
        const voiceNotePreview = document.getElementById('voice-note-preview');
        const voiceNoteAudio = document.getElementById('voice-note-audio');
        const clearVoiceNoteButton = document.getElementById('clear-voice-note');
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        // Emoji Seçimi için elementler
        const toggleEmojiPickerButton = document.getElementById('toggle-emoji-picker');
        const emojiPickerContainer = document.getElementById('emoji-picker-container');

        // Sayfa geçişlerini yöneten fonksiyon
        function showView(viewId) {
            homeView.classList.add('hidden');
            addReminderView.classList.add('hidden');
            settingsView.classList.add('hidden');
            document.getElementById(viewId).classList.remove('hidden');
            // FAB butonunu sadece ana sayfada gösteriyoruz
            fabAdd.classList.toggle('hidden', viewId !== 'home-view');
        }

        // Karanlık/Aydınlık mod temasını yöneten fonksiyon
        function setTheme(isDark) {
            body.classList.toggle('dark-mode', isDark);
            themeIcon.classList.toggle('fa-moon', !isDark);
            themeIcon.classList.toggle('fa-sun', isDark);
            localStorage.setItem('darkMode', isDark); // Ayarı kaydet
            darkModeToggle.checked = isDark;
        }

        // Tema değiştirme butonuna olay dinleyici ekle
        toggleThemeButton.addEventListener('click', () => {
            const isDark = body.classList.contains('dark-mode');
            setTheme(!isDark);
        });

        // Ayarlar sayfasındaki anahtara olay dinleyici ekle
        darkModeToggle.addEventListener('change', (e) => {
            setTheme(e.target.checked);
        });

        // Sayfa yüklendiğinde kayıtlı temayı uygula
        const savedTheme = localStorage.getItem('darkMode') === 'true';
        setTheme(savedTheme);

        // Navigasyon butonlarına olay dinleyici ekle
        openSettingsButton.addEventListener('click', () => {
            showView('settings-view');
        });
        fabAdd.addEventListener('click', () => {
            showView('add-reminder-view');
        });

        // Hatırlatıcı verilerini tutma ve yerel depolamadan (localStorage) okuma
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];

        // Hatırlatıcıları sayfaya render eden fonksiyon
        function renderReminders() {
            reminderList.innerHTML = '';
            if (reminders.length === 0) {
                reminderList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 mt-8">Henüz bir hatırlatıcınız yok. Eklemek için <i class="fas fa-plus"></i> butonuna basın.</p>';
            }
            reminders.forEach(reminder => {
                const reminderElement = document.createElement('div');
                reminderElement.className = 'card p-4 rounded-xl shadow-md flex items-center justify-between';
                
                const time = new Date(reminder.dateTime).toLocaleString('tr-TR', {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // İçerik, metin veya sesli nota göre değişir
                let contentHTML = `<p class="text-lg">${reminder.text}</p>`;
                if (reminder.voiceNote) {
                    contentHTML = `<div class="voice-note-player flex items-center gap-2">
                        <audio controls src="${reminder.voiceNote}"></audio>
                    </div>`;
                }
                
                reminderElement.innerHTML = `
                    <div class="flex-grow">
                        <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">${time}</div>
                        ${contentHTML}
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full delete-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // Silme butonuna olay dinleyici ekle
                reminderElement.querySelector('.delete-btn').addEventListener('click', () => {
                    reminders = reminders.filter(r => r.id !== reminder.id);
                    localStorage.setItem('reminders', JSON.stringify(reminders));
                    renderReminders();
                    showToast('Hatırlatıcı silindi!', 'bg-red-500');
                });
                
                reminderList.appendChild(reminderElement);
            });
        }

        // Sayfa yüklendiğinde hatırlatıcıları render et
        renderReminders();

        // Hatırlatıcıyı kaydetme butonu
        saveReminderButton.addEventListener('click', () => {
            const text = reminderText.value;
            const dateTime = reminderDateTime.value;
            const voiceNote = voiceNoteAudio.src !== '' ? voiceNoteAudio.src : null;

            if (!text && !voiceNote) {
                showToast('Lütfen bir metin veya sesli not girin!', 'bg-red-500');
                return;
            }
            if (!dateTime) {
                showToast('Lütfen bir tarih ve saat seçin!', 'bg-red-500');
                return;
            }

            const newReminder = {
                id: Date.now(),
                text: text,
                dateTime: dateTime,
                voiceNote: voiceNote
            };
            reminders.push(newReminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            // Web Notification API ile bildirim planla
            scheduleNotification(newReminder);
            
            showToast('Hatırlatıcı başarıyla kaydedildi!', 'bg-green-500');
            
            // Formu temizle ve ana sayfaya dön
            reminderText.value = '';
            reminderDateTime.value = '';
            voiceNoteAudio.src = '';
            voiceNotePreview.classList.add('hidden');
            
            renderReminders();
            showView('home-view');
        });

        // Web Notification API ile bildirim planlayan fonksiyon
        function scheduleNotification(reminder) {
            // Tarayıcı bildirim izni verilmişse
            if ('Notification' in window && Notification.permission === 'granted') {
                const now = new Date();
                const reminderTime = new Date(reminder.dateTime);
                const delay = reminderTime.getTime() - now.getTime();

                if (delay > 0) {
                    setTimeout(() => {
                        const title = 'Unutmam Ben!';
                        const options = {
                            body: reminder.text,
                            icon: 'https://placehold.co/192x192/4a5568/ffffff?text=U'
                        };
                        new Notification(title, options);
                        
                        // Sesli not varsa onu çal
                        if (reminder.voiceNote) {
                           const audio = new Audio(reminder.voiceNote);
                           audio.play();
                        }
                    }, delay);
                } else if (delay <= 0) {
                    showToast('Seçtiğiniz zaman geçmişte kalmış!', 'bg-red-500');
                }
            // İzin istenmemişse, izin iste
            } else if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        scheduleNotification(reminder);
                    }
                });
            } else {
                 showToast('Bildirim izni verilmediği için hatırlatıcılar çalışmayabilir.', 'bg-yellow-500');
            }
        }

        // Kullanıcıya geri bildirim sağlayan geçici mesaj (Toast) fonksiyonu
        function showToast(message, bgColor) {
            const toast = document.createElement('div');
            toast.className = `p-3 rounded-xl text-white shadow-lg mb-2 ${bgColor} transition-opacity duration-500 ease-in-out opacity-0`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            // Animasyon için küçük bir gecikme
            setTimeout(() => {
                toast.classList.remove('opacity-0');
            }, 10);

            // 3 saniye sonra mesajı gizle
            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.addEventListener('transitionend', () => {
                    toast.remove();
                });
            }, 3000);
        }

        // Sesli Not Kayıt Fonksiyonları
        recordVoiceButton.addEventListener('click', async () => {
            if (isRecording) {
                // Kaydı durdur
                mediaRecorder.stop();
                recordVoiceButton.innerHTML = '<i class="fas fa-microphone mr-2"></i>Sesli Not Kaydet';
                recordVoiceButton.classList.remove('bg-red-600');
                recordVoiceButton.classList.add('bg-red-500');
                isRecording = false;
            } else {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    isRecording = true;
                    audioChunks = [];

                    mediaRecorder.addEventListener("dataavailable", event => {
                        audioChunks.push(event.data);
                    });

                    mediaRecorder.addEventListener("stop", () => {
                        const audioBlob = new Blob(audioChunks);
                        const audioUrl = URL.createObjectURL(audioBlob);
                        voiceNoteAudio.src = audioUrl;
                        voiceNotePreview.classList.remove('hidden');
                    });

                    recordVoiceButton.innerHTML = '<i class="fas fa-microphone-slash mr-2"></i>Kaydı Durdur';
                    recordVoiceButton.classList.remove('bg-red-500');
                    recordVoiceButton.classList.add('bg-red-600');
                } catch (err) {
                    showToast('Mikrofon erişimi reddedildi.', 'bg-red-500');
                }
            }
        });

        // Sesli notu temizleme butonu
        clearVoiceNoteButton.addEventListener('click', () => {
            voiceNoteAudio.src = '';
            voiceNotePreview.classList.add('hidden');
        });

        // Emoji Seçimi
        toggleEmojiPickerButton.addEventListener('click', () => {
            // Şimdilik sadece butonu gösterip gizliyoruz, daha sonra bir emoji klavyesi entegre edilebilir.
            emojiPickerContainer.classList.toggle('hidden');
        });
        
        // Uygulama yüklendiğinde çalışacak kodlar
        window.addEventListener('load', () => {
            // Ana görünümü göster
            showView('home-view');
            
            // Bildirim izni iste
            if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
        });

        // Tarih ve saat alanını otomatik olarak şimdiki zamana ayarla
        document.addEventListener('DOMContentLoaded', () => {
          const now = new Date();
          now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
          const nowString = now.toISOString().slice(0, 16);
          reminderDateTime.value = nowString;
        });

    </script>
</body>
</html>
