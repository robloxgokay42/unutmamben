<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unutmam Ben!</title>
    <!-- Font Awesome ve Tailwind CSS k√ºt√ºphanelerini y√ºkl√ºyoruz -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Google Fonts - Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A√ßƒ±k mod arka plan rengi */
            color: #1a202c; /* A√ßƒ±k mod yazƒ± rengi */
            transition: background-color 0.3s, color 0.3s;
            font-size: 16px;
        }
        /* Karanlƒ±k mod stilleri */
        .dark-mode body {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .card {
            background-color: #ffffff;
            transition: background-color 0.3s;
        }
        .dark-mode .card {
            background-color: #2d3748;
        }
        .btn-primary {
            background-color: #4a5568;
            color: #ffffff;
            transition: background-color 0.3s;
        }
        .dark-mode .btn-primary {
            background-color: #a0aec0;
            color: #1a202c;
        }
        .btn-primary:hover {
            background-color: #2d3748;
        }
        .dark-mode .btn-primary:hover {
            background-color: #c0c6d4;
        }
        /* Karanlƒ±k mod i√ßin anahtar d√ºƒüme stilleri */
        .toggle-switch {
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4a5568;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        /* Sesli not oynatƒ±cƒ± stilleri */
        .voice-note-player {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #edf2f7;
            padding: 8px 12px;
            border-radius: 8px;
        }
        .dark-mode .voice-note-player {
            background-color: #4a5568;
        }
        /* Yazƒ± boyutuna g√∂re body font boyutunu ayarla */
        .text-small { font-size: 14px; }
        .text-medium { font-size: 16px; }
        .text-large { font-size: 20px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- √úst Men√º √áubuƒüu (Navbar) -->
    <header class="bg-gray-800 text-white p-4 shadow-md flex justify-between items-center fixed top-0 left-0 w-full z-10">
        <h1 class="text-2xl font-bold">Unutmam Ben!</h1>
        <div class="flex items-center gap-4">
            <!-- Karanlƒ±k/Aydƒ±nlƒ±k Mod Butonu -->
            <button id="toggle-theme" class="text-white p-2 rounded-full hover:bg-gray-700 transition">
                <i class="fas fa-moon text-lg" id="theme-icon"></i>
            </button>
            <!-- Ayarlar Sayfasƒ± Butonu -->
            <button id="open-settings" class="text-white p-2 rounded-full hover:bg-gray-700 transition">
                <i class="fas fa-cog text-lg"></i>
            </button>
        </div>
    </header>

    <!-- Ana ƒ∞√ßerik Alanƒ± -->
    <main class="flex-grow p-4 mt-16 pb-20">
        <div id="main-view" class="container mx-auto max-w-xl">
            
            <!-- Ana Sayfa - Hatƒ±rlatƒ±cƒ± Listesi -->
            <div id="home-view" class="space-y-4">
                <div id="reminder-list">
                    <!-- Hatƒ±rlatƒ±cƒ±lar buraya dinamik olarak eklenecek -->
                </div>
            </div>

            <!-- Yeni Hatƒ±rlatƒ±cƒ± Ekleme Formu -->
            <div id="add-reminder-view" class="hidden">
                <div class="card p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-4">Yeni Hatƒ±rlatƒ±cƒ± Ekle</h2>
                    <input id="reminder-text" type="text" placeholder="Hatƒ±rlatmak istediƒüin ≈üeyi yaz..." class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 mb-4">

                    <div class="flex items-center space-x-4 mb-4">
                        <input id="reminder-datetime" type="datetime-local" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                    </div>

                    <!-- Emoji Se√ßme Butonu ve Konteyneri -->
                    <div class="relative mb-4">
                        <button id="toggle-emoji-picker" class="w-full p-3 rounded-lg bg-gray-200 hover:bg-gray-300 transition text-gray-700">
                            <i class="far fa-smile mr-2"></i>Emoji Ekle
                        </button>
                        <div id="emoji-picker-container" class="absolute hidden z-20 top-full mt-2 w-full">
                            <!-- TODO: Buraya emoji klavyesi eklenecek -->
                        </div>
                    </div>

                    <!-- Sesli Not Kaydetme Butonu -->
                    <button id="record-voice" class="w-full p-3 rounded-lg bg-red-500 hover:bg-red-600 transition text-white font-bold mb-4">
                        <i class="fas fa-microphone mr-2"></i>Sesli Not Kaydet
                    </button>
                    <div id="voice-note-preview" class="hidden flex items-center justify-between p-3 rounded-lg bg-gray-200 dark:bg-gray-700 mb-4">
                        <audio id="voice-note-audio" controls class="w-full"></audio>
                        <button id="clear-voice-note" class="ml-2 text-red-500 hover:text-red-700">
                            <i class="fas fa-times-circle text-xl"></i>
                        </button>
                    </div>

                    <button id="save-reminder" class="btn-primary w-full p-4 rounded-xl shadow-lg text-lg font-bold">Kaydet</button>
                </div>
            </div>

            <!-- Ayarlar Sayfasƒ± -->
            <div id="settings-view" class="hidden">
                <div class="card p-6 rounded-xl shadow-lg space-y-4">
                    <h2 class="text-xl font-bold mb-4">Ayarlar</h2>

                    <!-- Kullanƒ±cƒ± Modu Se√ßimi -->
                    <div class="space-y-2">
                        <h3 class="text-lg font-bold">Kullanƒ±cƒ± Modu</h3>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="user-mode" value="cocuk" class="form-radio">
                                <span class="ml-2">üßí √áocuk</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="user-mode" value="yetiskin" class="form-radio" checked>
                                <span class="ml-2">üë©‚Äçü¶∞ Gen√ß / Yeti≈ükin</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="user-mode" value="yasli" class="form-radio">
                                <span class="ml-2">üëµ Ya≈ülƒ±</span>
                            </label>
                        </div>
                    </div>

                    <!-- Yazƒ± Boyutu Se√ßimi -->
                    <div class="space-y-2">
                        <h3 class="text-lg font-bold">Yazƒ± Boyutu</h3>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="font-size" value="small" class="form-radio">
                                <span class="ml-2">K√º√ß√ºk</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="font-size" value="medium" class="form-radio" checked>
                                <span class="ml-2">Orta</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="font-size" value="large" class="form-radio">
                                <span class="ml-2">B√ºy√ºk</span>
                            </label>
                        </div>
                    </div>

                    <!-- Tema Se√ßimi -->
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold">Karanlƒ±k Mod</span>
                        <label class="toggle-switch relative inline-block">
                            <input type="checkbox" id="dark-mode-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <!-- Sesli Hatƒ±rlatma Ayarlarƒ± -->
                    <div class="space-y-2">
                        <h3 class="text-lg font-bold">Sesli Hatƒ±rlatma Ayarlarƒ±</h3>
                        <div class="flex justify-between items-center">
                            <span>Sesli Okuma A√ß/Kapat</span>
                            <label class="toggle-switch relative inline-block">
                                <input type="checkbox" id="tts-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Hatƒ±rlatmalarƒ± Sesle Ekle</span>
                            <label class="toggle-switch relative inline-block">
                                <input type="checkbox" id="voice-input-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Tarih ve Saat Ayarlarƒ± -->
                    <div class="space-y-2">
                        <h3 class="text-lg font-bold">Tarih ve Saat Ayarlarƒ±</h3>
                        <div class="flex justify-between items-center">
                            <span>Saat Bi√ßimi</span>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="time-format" value="12" class="form-radio">
                                    <span class="ml-2">12 Saat</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="time-format" value="24" class="form-radio" checked>
                                    <span class="ml-2">24 Saat</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Yeni Hatƒ±rlatƒ±cƒ± Ekleme Butonu (FAB) -->
    <button id="fab-add" class="fixed bottom-4 right-4 bg-gray-800 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-3xl hover:bg-gray-700 transition">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- Toast Mesajlarƒ± i√ßin Konteyner -->
    <div id="toast-container" class="fixed bottom-16 left-1/2 -translate-x-1/2 flex flex-col items-center z-50"></div>
    
    <script>
        // GLOBAL DEƒûƒ∞≈ûKENLER - En ba≈üta tanƒ±mlanmalƒ±dƒ±r
        const body = document.body;
        const toggleThemeButton = document.getElementById('toggle-theme');
        const themeIcon = document.getElementById('theme-icon');
        const openSettingsButton = document.getElementById('open-settings');
        const homeView = document.getElementById('home-view');
        const addReminderView = document.getElementById('add-reminder-view');
        const settingsView = document.getElementById('settings-view');
        const fabAdd = document.getElementById('fab-add');
        const reminderList = document.getElementById('reminder-list');
        const reminderText = document.getElementById('reminder-text');
        const reminderDateTime = document.getElementById('reminder-datetime');
        const saveReminderButton = document.getElementById('save-reminder');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const toastContainer = document.getElementById('toast-container');
        
        // Sesli not kayƒ±t ve oynatma elementleri
        const recordVoiceButton = document.getElementById('record-voice');
        const voiceNotePreview = document.getElementById('voice-note-preview');
        const voiceNoteAudio = document.getElementById('voice-note-audio');
        const clearVoiceNoteButton = document.getElementById('clear-voice-note');
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        // Emoji Se√ßimi i√ßin elementler
        const toggleEmojiPickerButton = document.getElementById('toggle-emoji-picker');
        const emojiPickerContainer = document.getElementById('emoji-picker-container');

        // Ayarlar elementleri
        const userModeRadios = document.querySelectorAll('input[name="user-mode"]');
        const fontSizeRadios = document.querySelectorAll('input[name="font-size"]');
        const ttsToggle = document.getElementById('tts-toggle');
        const voiceInputToggle = document.getElementById('voice-input-toggle');
        const timeFormatRadios = document.querySelectorAll('input[name="time-format"]');

        // Hatƒ±rlatƒ±cƒ± verilerini tutma ve yerel depolamadan (localStorage) okuma
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        
        // FONKSƒ∞YONLAR - Deƒüi≈ükenlerden sonra tanƒ±mlanmalƒ±dƒ±r
        
        // Sayfa ge√ßi≈ülerini y√∂neten fonksiyon
        function showView(viewId) {
            homeView.classList.add('hidden');
            addReminderView.classList.add('hidden');
            settingsView.classList.add('hidden');
            document.getElementById(viewId).classList.remove('hidden');
            fabAdd.classList.toggle('hidden', viewId !== 'home-view');
        }

        // Hatƒ±rlatƒ±cƒ±larƒ± sayfaya render eden fonksiyon
        function renderReminders() {
            reminderList.innerHTML = '';
            if (reminders.length === 0) {
                reminderList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 mt-8">Hen√ºz bir hatƒ±rlatƒ±cƒ±nƒ±z yok. Eklemek i√ßin <i class="fas fa-plus"></i> butonuna basƒ±n.</p>';
            }
            const savedTimeFormat = localStorage.getItem('timeFormat') || '24';
            reminders.forEach(reminder => {
                const reminderElement = document.createElement('div');
                reminderElement.className = 'card p-4 rounded-xl shadow-md flex items-center justify-between';
                
                const time = new Date(reminder.dateTime).toLocaleString('tr-TR', {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    hour: savedTimeFormat === '12' ? 'numeric' : '2-digit',
                    minute: '2-digit',
                    hour12: savedTimeFormat === '12'
                });
                
                let contentHTML = `<p class="text-lg">${reminder.text}</p>`;
                if (reminder.voiceNote) {
                    contentHTML = `<div class="voice-note-player flex items-center gap-2">
                        <audio controls src="${reminder.voiceNote}"></audio>
                    </div>`;
                }
                
                reminderElement.innerHTML = `
                    <div class="flex-grow">
                        <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">${time}</div>
                        ${contentHTML}
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full delete-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                reminderElement.querySelector('.delete-btn').addEventListener('click', () => {
                    reminders = reminders.filter(r => r.id !== reminder.id);
                    localStorage.setItem('reminders', JSON.stringify(reminders));
                    renderReminders();
                    showToast('Hatƒ±rlatƒ±cƒ± silindi!', 'bg-red-500');
                });
                
                reminderList.appendChild(reminderElement);
            });
        }

        // Karanlƒ±k/Aydƒ±nlƒ±k mod temasƒ±nƒ± y√∂neten fonksiyon
        function setTheme(isDark) {
            body.classList.toggle('dark-mode', isDark);
            themeIcon.classList.toggle('fa-moon', !isDark);
            themeIcon.classList.toggle('fa-sun', isDark);
            localStorage.setItem('darkMode', isDark);
            darkModeToggle.checked = isDark;
            renderReminders(); // Tema deƒüi≈ütiƒüinde hatƒ±rlatƒ±cƒ±larƒ± yeniden √ßiz
        }

        // Yazƒ± boyutunu y√∂neten fonksiyon
        function setFontSize(size) {
            body.classList.remove('text-small', 'text-medium', 'text-large');
            body.classList.add(`text-${size}`);
            localStorage.setItem('fontSize', size);
            fontSizeRadios.forEach(radio => {
                radio.checked = (radio.value === size);
            });
            renderReminders(); // Yazƒ± boyutu deƒüi≈ütiƒüinde hatƒ±rlatƒ±cƒ±larƒ± yeniden √ßiz
        }

        // Saat bi√ßimini y√∂neten fonksiyon
        function setTimeFormat(format) {
            localStorage.setItem('timeFormat', format);
            timeFormatRadios.forEach(radio => {
                radio.checked = (radio.value === format);
            });
            renderReminders(); // Saat formatƒ± deƒüi≈ütiƒüinde hatƒ±rlatƒ±cƒ±larƒ± yeniden √ßiz
        }
        
        // Web Notification API ile bildirim planlayan fonksiyon
        function scheduleNotification(reminder) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const now = new Date();
                const reminderTime = new Date(reminder.dateTime);
                const delay = reminderTime.getTime() - now.getTime();

                if (delay > 0) {
                    setTimeout(() => {
                        const title = 'Unutmam Ben!';
                        const options = {
                            body: reminder.text,
                            icon: 'https://placehold.co/192x192/4a5568/ffffff?text=U'
                        };
                        new Notification(title, options);
                        
                        if (reminder.voiceNote) {
                           const audio = new Audio(reminder.voiceNote);
                           audio.play();
                        }
                        if (reminder.isVoiced) {
                           speak(reminder.text);
                        }
                    }, delay);
                } else if (delay <= 0) {
                    showToast('Se√ßtiƒüiniz zaman ge√ßmi≈üte kalmƒ±≈ü!', 'bg-red-500');
                }
            } else if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        scheduleNotification(reminder);
                    }
                });
            } else {
                 showToast('Bildirim izni verilmediƒüi i√ßin hatƒ±rlatƒ±cƒ±lar √ßalƒ±≈ümayabilir.', 'bg-yellow-500');
            }
        }

        // Kullanƒ±cƒ±ya geri bildirim saƒülayan ge√ßici mesaj (Toast) fonksiyonu
        function showToast(message, bgColor) {
            const toast = document.createElement('div');
            toast.className = `p-3 rounded-xl text-white shadow-lg mb-2 ${bgColor} transition-opacity duration-500 ease-in-out opacity-0`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('opacity-0');
            }, 10);

            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.addEventListener('transitionend', () => {
                    toast.remove();
                });
            }, 3000);
        }

        // Sesli Not Kayƒ±t Fonksiyonlarƒ±
        recordVoiceButton.addEventListener('click', async () => {
            if (isRecording) {
                mediaRecorder.stop();
                recordVoiceButton.innerHTML = '<i class="fas fa-microphone mr-2"></i>Sesli Not Kaydet';
                recordVoiceButton.classList.remove('bg-red-600');
                recordVoiceButton.classList.add('bg-red-500');
                isRecording = false;
            } else {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    isRecording = true;
                    audioChunks = [];

                    mediaRecorder.addEventListener("dataavailable", event => {
                        audioChunks.push(event.data);
                    });

                    mediaRecorder.addEventListener("stop", () => {
                        const audioBlob = new Blob(audioChunks);
                        const audioUrl = URL.createObjectURL(audioBlob);
                        voiceNoteAudio.src = audioUrl;
                        voiceNotePreview.classList.remove('hidden');
                    });

                    recordVoiceButton.innerHTML = '<i class="fas fa-microphone-slash mr-2"></i>Kaydƒ± Durdur';
                    recordVoiceButton.classList.remove('bg-red-500');
                    recordVoiceButton.classList.add('bg-red-600');
                } catch (err) {
                    showToast('Mikrofon eri≈üimi reddedildi.', 'bg-red-500');
                }
            }
        });

        // Sesli notu temizleme butonu
        clearVoiceNoteButton.addEventListener('click', () => {
            voiceNoteAudio.src = '';
            voiceNotePreview.classList.add('hidden');
        });

        // Emoji Se√ßimi
        toggleEmojiPickerButton.addEventListener('click', () => {
            emojiPickerContainer.classList.toggle('hidden');
        });
        
        // Uygulama ba≈üladƒ±ƒüƒ±nda ve ayarlarƒ± y√ºkleme
        window.addEventListener('load', () => {
            // Kayƒ±tlƒ± ayarlarƒ± uygula
            const savedTheme = localStorage.getItem('darkMode') === 'true';
            setTheme(savedTheme);
            const savedFontSize = localStorage.getItem('fontSize') || 'medium';
            setFontSize(savedFontSize);
            const savedTimeFormat = localStorage.getItem('timeFormat') || '24';
            setTimeFormat(savedTimeFormat);

            // Ana g√∂r√ºn√ºm√º g√∂ster
            showView('home-view');
            
            // Bildirim izni iste
            if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
        });

        // Olay Dinleyicileri
        toggleThemeButton.addEventListener('click', () => {
            const isDark = body.classList.contains('dark-mode');
            setTheme(!isDark);
        });

        darkModeToggle.addEventListener('change', (e) => {
            setTheme(e.target.checked);
        });

        fontSizeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                setFontSize(e.target.value);
            });
        });

        timeFormatRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                setTimeFormat(e.target.value);
            });
        });
        
        openSettingsButton.addEventListener('click', () => {
            showView('settings-view');
        });
        fabAdd.addEventListener('click', () => {
            showView('add-reminder-view');
        });

        saveReminderButton.addEventListener('click', () => {
            const text = reminderText.value;
            const dateTime = reminderDateTime.value;
            const voiceNote = voiceNoteAudio.src !== '' ? voiceNoteAudio.src : null;
            const isVoiced = ttsToggle.checked;

            if (!text && !voiceNote) {
                showToast('L√ºtfen bir metin veya sesli not girin!', 'bg-red-500');
                return;
            }
            if (!dateTime) {
                showToast('L√ºtfen bir tarih ve saat se√ßin!', 'bg-red-500');
                return;
            }

            const newReminder = {
                id: Date.now(),
                text: text,
                dateTime: dateTime,
                voiceNote: voiceNote,
                isVoiced: isVoiced,
            };
            reminders.push(newReminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            scheduleNotification(newReminder);
            
            showToast('Hatƒ±rlatƒ±cƒ± ba≈üarƒ±yla kaydedildi!', 'bg-green-500');
            
            reminderText.value = '';
            reminderDateTime.value = '';
            voiceNoteAudio.src = '';
            voiceNotePreview.classList.add('hidden');
            
            renderReminders();
            showView('home-view');
        });

        // Tarih ve saat alanƒ±nƒ± otomatik olarak ≈üimdiki zamana ayarla
        document.addEventListener('DOMContentLoaded', () => {
          const now = new Date();
          now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
          const nowString = now.toISOString().slice(0, 16);
          reminderDateTime.value = nowString;
        });

    </script>
</body>
</html>
